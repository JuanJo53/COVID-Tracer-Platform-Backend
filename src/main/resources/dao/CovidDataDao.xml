<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="bo.ucb.edu.covid_tracer_platform_backend.dao.CovidDataDao">
    <insert id="createCovidData" parameterType="bo.ucb.edu.covid_tracer_platform_backend.model.CovidData">
        INSERT INTO `covid_data`(`covid_data_id`, `country_id`, `department_id`, `municipality_id`, `confirmed`, `cumulative_confirmed`, `dead`, `cumulative_dead`, `recovered`, `cumulative_recovered`, `date`, `status`, `tx_id`, `tx_host`, `tx_user_id`, `tx_date`)
                         VALUES (null,#{countryId},#{departmentId},#{municipalityId},#{confirmed},#{cumulativeConfirmed},#{dead},#{cumulativeDead},#{recovered},#{cumulativeRecovered},#{date},1,#{transaction.txId},#{transaction.txHost},#{transaction.txUserId},#{transaction.txDate})
    </insert>

    <select id="lastDateDepartment" resultType="java.util.Date">
        SELECT MAX(date)
        FROM covid_data
        WHERE
            department_id = #{departmentId}
            and municipality_id is NULL
            and status = 1
    </select>

    <select id="getCovidDataTotalByDepartment" resultType="java.lang.Integer">
        select COUNT(covid_data_id)
        from covid_data
        where
            department_id = #{departmentId}
            and municipality_id is NULL
            and status = 1
    </select>

    <select id="covidDataHistoricListByDepartment" resultMap="covidDataMap">
        SELECT
            covid_data_id as id,
            date as date,
            confirmed as confirmed,
            dead as dead,
            recovered as recovered
        FROM covid_data
        WHERE
            department_id = #{departmentId}
            and municipality_id is NULL
            and status = 1
        LIMIT #{size} OFFSET #{page}
    </select>

    <select id="covidDataCumulativeListByDepartment" resultMap="covidDataMap">
        SELECT
            covid_data_id as id,
            date as date,
            cumulative_confirmed as confirmed,
            cumulative_dead as dead,
            cumulative_recovered as recovered
        FROM covid_data
        WHERE
            department_id = #{departmentId}
          and municipality_id is NULL
          and status = 1
            LIMIT #{size} OFFSET #{page}
    </select>

    <resultMap id="covidDataMap" type="bo.ucb.edu.covid_tracer_platform_backend.dto.CovidDataListDepartment">
        <result column="id" property="id"/>
        <result column="date" property="date"/>
        <result column="confirmed" property="confirmed"/>
        <result column="dead" property="dead"/>
        <result column="recovered" property="recovered"/>
    </resultMap>
</mapper>
